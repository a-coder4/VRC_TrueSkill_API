var k={"Content-Type":"application/json"},v=/\{[^{}]+\}/g,g=class extends Request{constructor(e,t){super(e,t);for(let r in t)r in this||(this[r]=t[r])}};function B(){return Math.random().toString(36).slice(2,11)}function q(n){let{baseUrl:e="",fetch:t=globalThis.fetch,querySerializer:r,bodySerializer:i,headers:o,...l}={...n};e=P(e),o=D(k,o);let c=[];async function u(a,s){let{baseUrl:p,fetch:z=t,headers:L,params:b={},parseAs:T="json",querySerializer:m,bodySerializer:C=i??G,...N}=s||{};p&&(e=P(p));let E=typeof r=="function"?r:U(r);m&&(E=typeof m=="function"?m:U({...typeof r=="object"?r:{},...m}));let y={redirect:"follow",...l,...N,headers:D(o,L,b.header)};y.body!==void 0&&(y.body=C(y.body),y.body instanceof FormData&&y.headers.delete("Content-Type"));let j,x,w=new g(M(a,{baseUrl:e,params:b,querySerializer:E}),y);if(c.length){j=B(),x=Object.freeze({baseUrl:e,fetch:z,parseAs:T,querySerializer:E,bodySerializer:C});for(let d of c)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){let h=await d.onRequest({request:w,schemaPath:a,params:b,options:x,id:j});if(h){if(!(h instanceof Request))throw new Error("onRequest: must return new Request() when modifying the request");w=h}}}let f=await z(w);if(c.length)for(let d=c.length-1;d>=0;d--){let h=c[d];if(h&&typeof h=="object"&&typeof h.onResponse=="function"){let S=await h.onResponse({request:w,response:f,schemaPath:a,params:b,options:x,id:j});if(S){if(!(S instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");f=S}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return T==="stream"?{data:f.body,response:f}:{data:await f[T](),response:f};let A=await f.text();try{A=JSON.parse(A)}catch{}return{error:A,response:f}}return{GET(a,s){return u(a,{...s,method:"GET"})},PUT(a,s){return u(a,{...s,method:"PUT"})},POST(a,s){return u(a,{...s,method:"POST"})},DELETE(a,s){return u(a,{...s,method:"DELETE"})},OPTIONS(a,s){return u(a,{...s,method:"OPTIONS"})},HEAD(a,s){return u(a,{...s,method:"HEAD"})},PATCH(a,s){return u(a,{...s,method:"PATCH"})},TRACE(a,s){return u(a,{...s,method:"TRACE"})},use(...a){for(let s of a)if(s){if(typeof s!="object"||!("onRequest"in s||"onResponse"in s))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");c.push(s)}},eject(...a){for(let s of a){let p=c.indexOf(s);p!==-1&&c.splice(p,1)}}}}var $=class{constructor(e,t){this.client=e,this.url=t}GET(e){return this.client.GET(this.url,e)}PUT(e){return this.client.PUT(this.url,e)}POST(e){return this.client.POST(this.url,e)}DELETE(e){return this.client.DELETE(this.url,e)}OPTIONS(e){return this.client.OPTIONS(this.url,e)}HEAD(e){return this.client.HEAD(this.url,e)}PATCH(e){return this.client.PATCH(this.url,e)}TRACE(e){return this.client.TRACE(this.url,e)}},O=class{constructor(){this.client=null}get(e,t){let r=new $(e,t);return this.client[t]=r,r}};function F(n){let e=new O,t=new Proxy(n,e);function r(){}r.prototype=t;let i=new r;return e.client=i,i}function Q(n){return F(q(n))}function R(n,e,t){if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${n}=${t?.allowReserved===!0?e:encodeURIComponent(e)}`}function H(n,e,t){if(!e||typeof e!="object")return"";let r=[],i={simple:",",label:".",matrix:";"}[t.style]||"&";if(t.style!=="deepObject"&&t.explode===!1){for(let c in e)r.push(c,t.allowReserved===!0?e[c]:encodeURIComponent(e[c]));let l=r.join(",");switch(t.style){case"form":return`${n}=${l}`;case"label":return`.${l}`;case"matrix":return`;${n}=${l}`;default:return l}}for(let l in e){let c=t.style==="deepObject"?`${n}[${l}]`:l;r.push(R(c,e[l],t))}let o=r.join(i);return t.style==="label"||t.style==="matrix"?`${i}${o}`:o}function I(n,e,t){if(!Array.isArray(e))return"";if(t.explode===!1){let o={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[t.style]||",",l=(t.allowReserved===!0?e:e.map(c=>encodeURIComponent(c))).join(o);switch(t.style){case"simple":return l;case"label":return`.${l}`;case"matrix":return`;${n}=${l}`;default:return`${n}=${l}`}}let r={simple:",",label:".",matrix:";"}[t.style]||"&",i=[];for(let o of e)t.style==="simple"||t.style==="label"?i.push(t.allowReserved===!0?o:encodeURIComponent(o)):i.push(R(n,o,t));return t.style==="label"||t.style==="matrix"?`${r}${i.join(r)}`:i.join(r)}function U(n){return function(t){let r=[];if(t&&typeof t=="object")for(let i in t){let o=t[i];if(o!=null){if(Array.isArray(o)){r.push(I(i,o,{style:"form",explode:!0,...n?.array,allowReserved:n?.allowReserved||!1}));continue}if(typeof o=="object"){r.push(H(i,o,{style:"deepObject",explode:!0,...n?.object,allowReserved:n?.allowReserved||!1}));continue}r.push(R(i,o,n))}}return r.join("&")}}function W(n,e){let t=n;for(let r of n.match(v)??[]){let i=r.substring(1,r.length-1),o=!1,l="simple";if(i.endsWith("*")&&(o=!0,i=i.substring(0,i.length-1)),i.startsWith(".")?(l="label",i=i.substring(1)):i.startsWith(";")&&(l="matrix",i=i.substring(1)),!e||e[i]===void 0||e[i]===null)continue;let c=e[i];if(Array.isArray(c)){t=t.replace(r,I(i,c,{style:l,explode:o}));continue}if(typeof c=="object"){t=t.replace(r,H(i,c,{style:l,explode:o}));continue}if(l==="matrix"){t=t.replace(r,`;${R(i,c)}`);continue}t=t.replace(r,l==="label"?`.${encodeURIComponent(c)}`:encodeURIComponent(c))}return t}function G(n){return n instanceof FormData?n:JSON.stringify(n)}function M(n,e){let t=`${e.baseUrl}${n}`;e.params?.path&&(t=W(t,e.params.path));let r=e.querySerializer(e.params.query??{});return r.startsWith("?")&&(r=r.substring(1)),r&&(t+=`?${r}`),t}function D(...n){let e=new Headers;for(let t of n){if(!t||typeof t!="object")continue;let r=t instanceof Headers?t.entries():Object.entries(t);for(let[i,o]of r)if(o===null)e.delete(i);else if(Array.isArray(o))for(let l of o)e.append(i,l);else o!==void 0&&e.set(i,o)}return e}function P(n){return n.endsWith("/")?n.substring(0,n.length-1):n}export{M as createFinalURL,Q as createPathBasedClient,U as createQuerySerializer,q as default,G as defaultBodySerializer,W as defaultPathSerializer,D as mergeHeaders,B as randomID,P as removeTrailingSlash,I as serializeArrayParam,H as serializeObjectParam,R as serializePrimitiveParam,F as wrapAsPathBasedClient};
